<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russisch: Kreative Satzvollendung</title>
    <style>
        :root {
            --primary: #8e44ad; /* Lila f√ºr Kreativit√§t */
            --primary-dark: #7d3c98;
            --success: #2ecc71;
            --error: #e74c3c;
            --bg: #fdfdfd;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --slot-bg: #f0f3f4;
            --border-radius: 16px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f7;
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .intro {
            background-color: #f4ecf7;
            border-left: 5px solid var(--primary);
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 4px;
            color: #5b2c6f;
        }

        /* --- Progress --- */
        .progress-header {
            text-align: right;
            font-weight: bold;
            color: #95a5a6;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- Game Board --- */
        .game-board {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        /* The Sentence Construction Area */
        .sentence-area {
            font-size: 1.4rem;
            margin-bottom: 30px;
            line-height: 2.2; /* Platz f√ºr Slots */
        }

        .starter-text {
            font-weight: 600;
            color: #2c3e50;
        }

        .ref-word {
            color: var(--primary);
            text-decoration: underline;
            text-decoration-thickness: 3px;
            text-decoration-color: #d2b4de;
        }

        /* Slots */
        .slot {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
            height: 50px;
            background-color: var(--slot-bg);
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            margin: 0 5px;
            padding: 0 15px;
            color: #7f8c8d;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            vertical-align: middle;
            white-space: nowrap;
        }

        .slot.active {
            border-color: var(--primary);
            background-color: #fff;
            box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.1);
        }

        .slot.filled {
            border-style: solid;
            background-color: #ebdef0;
            color: var(--primary-dark);
            border-color: var(--primary);
            font-weight: bold;
        }

        .slot.correct {
            background-color: #d4edda;
            border-color: var(--success);
            color: #155724;
        }

        .slot.wrong {
            background-color: #f8d7da;
            border-color: var(--error);
            color: #721c24;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        /* Selection Area */
        .selection-area {
            margin-top: auto;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .selection-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #95a5a6;
            margin-bottom: 10px;
            font-weight: bold;
            display: block;
            text-align: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1rem;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .option-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            background: #fdfaff;
        }

        /* Feedback */
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .fb-success { background: #d4edda; color: #155724; }
        .fb-error { background: #f8d7da; color: #721c24; }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 30px;
            border: none;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn:hover { transform: scale(1.05); }
        
        .btn-reset { background: #95a5a6; }
        .btn-check { background: var(--primary); }
        .btn-next { background: var(--success); display: none; }

        /* End Screen */
        .end-screen {
            display: none;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 16px;
        }

        @media (max-width: 600px) {
            .sentence-area { font-size: 1.1rem; }
            .slot { min-width: 80px; height: 40px; font-size: 1rem; padding: 0 10px; }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Satz-Baukasten</h1>
    
    <div class="intro">
        <strong>Aufgabe:</strong> Beenden Sie den Satz kreativ und grammatikalisch korrekt.<br>
        1. W√§hlen Sie das <strong>Partizip</strong> (achten Sie auf den Kasus!).<br>
        2. W√§hlen Sie das <strong>logische Ende</strong>.
    </div>

    <div id="game-ui">
        <div class="progress-header">Satz <span id="current-q">1</span> / 10</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-bar"></div>
        </div>

        <div class="game-board">
            
            <div class="sentence-area">
                <span id="starter-text" class="starter-text">Lade...</span>
                <br>
                <!-- Slots -->
                <div class="slot" id="slot-participle" onclick="clearSlot(0)">Partizip?</div>
                <div class="slot" id="slot-ending" onclick="clearSlot(1)">Ende?</div>
            </div>

            <div class="feedback" id="feedback"></div>

            <div class="selection-area">
                <span class="selection-label" id="selection-label">W√§hle das Partizip:</span>
                <div class="options-grid" id="options-grid">
                    <!-- Buttons -->
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-reset" onclick="resetLevel()">Leeren</button>
                <button class="btn btn-check" onclick="checkAnswer()">Pr√ºfen</button>
                <button class="btn btn-next" id="btn-next" onclick="nextLevel()">Weiter &rarr;</button>
            </div>
        </div>
    </div>

    <div class="end-screen" id="end-screen">
        <h2>üéâ Fantastisch!</h2>
        <p>Sie haben alle S√§tze gebaut.</p>
        <p style="font-size: 3rem; margin: 20px 0;" id="final-score">10/10</p>
        <button class="btn btn-check" onclick="location.reload()">Neustart</button>
    </div>
</div>

<script>
    /*
        Datenstruktur:
        starter: Der Satzanfang (HTML erlaubt f√ºr styling)
        refHint: Hinweis zum Kasus (optional)
        
        partCorrect: Das richtige Partizip
        partDistractors: Falsche Partizipien (Falscher Kasus/Suffix)
        
        endCorrect: Das sinnvolle Ende
        endDistractors: Quatsch-Enden (andere Grammatik oder Unsinn)
        
        explanation: Erkl√§rung bei Fehler
    */
    const levels = [
        {
            starter: "–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–µ–ª <span class='ref-word'>—á–µ–ª–æ–≤–µ–∫–∞</span>,",
            partCorrect: "—Å—ä–µ–≤—à–µ–≥–æ", // Acc anim = Gen
            partDistractors: ["—Å—ä–µ–≤—à–∏–π", "—Å—ä–µ–≤—à–∏–º"],
            endCorrect: "10 –ø–∏—Ü—Ü.",
            endDistractors: ["–Ω–∞ –¥–∏–≤–∞–Ω–µ.", "–≥—Ä–æ–º–∫–æ."],
            explanation: "Bezugswort '—á–µ–ª–æ–≤–µ–∫–∞' ist Akkusativ belebt (wie Genitiv) -> Endung -–µ–≥–æ."
        },
        {
            starter: "–ú—ã –ø–æ–¥–æ—à–ª–∏ –∫ <span class='ref-word'>—Å–æ–±–∞–∫–µ</span>,",
            partCorrect: "—Å–∏–¥–µ–≤—à–µ–π", // Dat fem
            partDistractors: ["—Å–∏–¥–µ–≤—à–∞—è", "—Å–∏–¥–µ–≤—à—É—é"],
            endCorrect: "–≤ –º–∞—à–∏–Ω–µ.",
            endDistractors: ["–≤ —Å—É–ø.", "–≤—á–µ—Ä–∞."],
            explanation: "Bezugswort '—Å–æ–±–∞–∫–µ' ist Dativ -> Endung -–µ–π."
        },
        {
            starter: "–ü–æ–ª–∏—Ü–∏—è –∏—Å–∫–∞–ª–∞ <span class='ref-word'>–∫–æ—Ç–∞</span>,",
            partCorrect: "—É–∫—Ä–∞–≤—à–µ–≥–æ", // Acc anim = Gen
            partDistractors: ["—É–∫—Ä–∞–≤—à–∏–π", "—É–∫—Ä–∞–≤—à–∏–º"],
            endCorrect: "—Å–æ—Å–∏—Å–∫–∏.",
            endDistractors: ["–≤ –∫–∏–Ω–æ.", "–±—ã—Å—Ç—Ä–æ."],
            explanation: "Bezugswort '–∫–æ—Ç–∞' ist Akkusativ belebt -> Endung -–µ–≥–æ."
        },
        {
            starter: "–û–Ω –º–µ—á—Ç–∞–µ—Ç –æ <span class='ref-word'>–¥–µ–≤—É—à–∫–µ</span>,",
            partCorrect: "–∂–∏–≤—É—â–µ–π", // Prep fem (Pr√§sens Partizip hier √ºblicher, aber Aufgabe ist Past? 
            // OK, bleiben wir bei Past Active f√ºr Konsistenz: "–∂–∏–≤—à–µ–π")
            // Prompt sagt "Active Past Participles". Also:
            partCorrect: "–∂–∏–≤—à–µ–π",
            partDistractors: ["–∂–∏–≤—à–∞—è", "–∂–∏–≤—à—É—é"],
            endCorrect: "–Ω–∞ –õ—É–Ω–µ.",
            endDistractors: ["–±–æ—Ä—â.", "–∑–µ–ª—ë–Ω—ã–π."],
            explanation: "Bezugswort '–æ –¥–µ–≤—É—à–∫–µ' ist Pr√§positiv -> Endung -–µ–π."
        },
        {
            starter: "–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä —Å–ø–æ—Ä–∏–ª —Å–æ <span class='ref-word'>—Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</span>,",
            partCorrect: "–Ω–µ –≤—ã—É—á–∏–≤—à–∏–º–∏", // Instr Pl
            partDistractors: ["–Ω–µ –≤—ã—É—á–∏–≤—à–∏–µ", "–Ω–µ –≤—ã—É—á–∏–≤—à–∏—Ö"],
            endCorrect: "—É—Ä–æ–∫.",
            endDistractors: ["–¥–æ–º–æ–π.", "—Å—Ç–æ–ª."],
            explanation: "Bezugswort '—Å–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏' ist Instrumental Plural -> Endung -–∏–º–∏."
        },
        {
            starter: "–Ø –ø–æ–º–æ–≥ <span class='ref-word'>–±–∞–±—É—à–∫–µ</span>,",
            partCorrect: "–ø–æ—Ç–µ—Ä—è–≤—à–µ–π", // Dat fem
            partDistractors: ["–ø–æ—Ç–µ—Ä—è–≤—à–∞—è", "–ø–æ—Ç–µ—Ä—è–≤—à—É—é"],
            endCorrect: "–æ—á–∫–∏.",
            endDistractors: ["–≤ —Ñ—É—Ç–±–æ–ª.", "—Å–ø–∞—Ç—å."],
            explanation: "Bezugswort '–±–∞–±—É—à–∫–µ' ist Dativ -> Endung -–µ–π."
        },
        {
            starter: "–í –∑–æ–æ–ø–∞—Ä–∫–µ –º—ã –≤–∏–¥–µ–ª–∏ <span class='ref-word'>–ø–æ–ø—É–≥–∞—è</span>,",
            partCorrect: "–≥–æ–≤–æ—Ä–∏–≤—à–µ–≥–æ", // Acc anim = Gen
            partDistractors: ["–≥–æ–≤–æ—Ä–∏–≤—à–∏–π", "–≥–æ–≤–æ—Ä–∏–≤—à–µ–º"],
            endCorrect: "–ø–æ-–∫–∏—Ç–∞–π—Å–∫–∏.",
            endDistractors: ["–≤ –≤–æ–¥—É.", "—Å–∏–Ω–∏–π."],
            explanation: "'–ü–æ–ø—É–≥–∞—è' ist Akkusativ belebt -> Endung -–µ–≥–æ."
        },
        {
            starter: "–ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –∂–∏–ª–æ –≤ <span class='ref-word'>–¥–æ–º–µ</span>,",
            partCorrect: "—Å—Ç–æ—è–≤—à–µ–º", // Prep masc
            partDistractors: ["—Å—Ç–æ—è–≤—à–∏–π", "—Å—Ç–æ—è–≤—à–µ–≥–æ"],
            endCorrect: "–Ω–∞ –∫–ª–∞–¥–±–∏—â–µ.",
            endDistractors: ["—Å—É–ø.", "–≥—Ä–æ–º–∫–æ."],
            explanation: "'–í –¥–æ–º–µ' ist Pr√§positiv -> Endung -–µ–º."
        },
        {
            starter: "–ì–∏–¥ –≥–æ–≤–æ—Ä–∏–ª —Å <span class='ref-word'>—Ç—É—Ä–∏—Å—Ç–æ–º</span>,",
            partCorrect: "–∑–∞–±—ã–≤—à–∏–º", // Instr masc
            partDistractors: ["–∑–∞–±—ã–≤—à–∏–π", "–∑–∞–±—ã–≤—à–µ–≥–æ"],
            endCorrect: "–ø–∞—Å–ø–æ—Ä—Ç.",
            endDistractors: ["–Ω–∞ –≥–æ—Ä–µ.", "–∑–∞–≤—Ç—Ä–∞."],
            explanation: "'–° —Ç—É—Ä–∏—Å—Ç–æ–º' ist Instrumental -> Endung -–∏–º."
        },
        {
            starter: "–Ø –ø–æ–¥–∞—Ä–∏–ª —Ü–≤–µ—Ç—ã <span class='ref-word'>–∞—Ä—Ç–∏—Å—Ç–∫–µ</span>,",
            partCorrect: "–ø–µ–≤—à–µ–π", // Dat fem
            partDistractors: ["–ø–µ–≤—à–∞—è", "–ø–µ–≤—à—É—é"],
            endCorrect: "—ç—Ç—É –ø–µ—Å–Ω—é.",
            endDistractors: ["–Ω–∞ –¥–∏–≤–∞–Ω–µ.", "–≤–∫—É—Å–Ω–æ."],
            explanation: "'–ê—Ä—Ç–∏—Å—Ç–∫–µ' ist Dativ -> Endung -–µ–π."
        }
    ];

    let currentIdx = 0;
    let score = 0;
    
    // State: What is currently selected?
    let selectedParticiple = null;
    let selectedEnding = null;
    let currentStep = 0; // 0 = Selecting Participle, 1 = Selecting Ending

    // Elements
    const ui = document.getElementById('game-ui');
    const endScreen = document.getElementById('end-screen');
    const starterText = document.getElementById('starter-text');
    const slotPart = document.getElementById('slot-participle');
    const slotEnd = document.getElementById('slot-ending');
    const optionsGrid = document.getElementById('options-grid');
    const selectionLabel = document.getElementById('selection-label');
    const feedback = document.getElementById('feedback');
    const btnNext = document.getElementById('btn-next');
    const progressBar = document.getElementById('progress-bar');
    const qLabel = document.getElementById('current-q');
    const finalScore = document.getElementById('final-score');

    function initGame() {
        currentIdx = 0;
        score = 0;
        ui.style.display = 'block';
        endScreen.style.display = 'none';
        loadLevel(0);
    }

    function loadLevel(idx) {
        currentIdx = idx;
        const data = levels[idx];

        // UI Update
        qLabel.textContent = idx + 1;
        progressBar.style.width = `${(idx / levels.length) * 100}%`;
        starterText.innerHTML = data.starter;

        resetLevelState();
    }

    function resetLevelState() {
        selectedParticiple = null;
        selectedEnding = null;
        currentStep = 0;

        // Slots Visual Reset
        slotPart.className = 'slot active';
        slotPart.textContent = 'Partizip?';
        slotEnd.className = 'slot';
        slotEnd.textContent = 'Ende?';
        
        feedback.style.display = 'none';
        btnNext.style.display = 'none';

        showParticipleOptions();
    }

    // Step 1: Show Participles
    function showParticipleOptions() {
        currentStep = 0;
        selectionLabel.textContent = "Schritt 1: W√§hle das passende Partizip";
        optionsGrid.innerHTML = '';
        
        const data = levels[currentIdx];
        const opts = [data.partCorrect, ...data.partDistractors].sort(() => 0.5 - Math.random());

        opts.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.onclick = () => selectParticiple(opt);
            optionsGrid.appendChild(btn);
        });
        
        // Highlight active slot
        slotPart.classList.add('active');
        slotEnd.classList.remove('active');
    }

    function selectParticiple(text) {
        selectedParticiple = text;
        slotPart.textContent = text;
        slotPart.className = 'slot filled';
        
        // Move to Step 2
        showEndingOptions();
    }

    // Step 2: Show Endings
    function showEndingOptions() {
        currentStep = 1;
        selectionLabel.textContent = "Schritt 2: W√§hle das logische Ende";
        optionsGrid.innerHTML = '';
        
        const data = levels[currentIdx];
        const opts = [data.endCorrect, ...data.endDistractors].sort(() => 0.5 - Math.random());

        opts.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.onclick = () => selectEnding(opt);
            optionsGrid.appendChild(btn);
        });

        // Highlight active slot
        slotPart.classList.remove('active');
        slotEnd.classList.add('active');
    }

    function selectEnding(text) {
        selectedEnding = text;
        slotEnd.textContent = text;
        slotEnd.className = 'slot filled';
        slotEnd.classList.remove('active');
        
        selectionLabel.textContent = "Bereit zum Pr√ºfen!";
        optionsGrid.innerHTML = ''; // Clear options
    }

    function clearSlot(slotId) {
        // Allow user to click slot to re-select
        if (btnNext.style.display === 'inline-block') return; // Locked if finished

        if (slotId === 0) {
            // Reset everything from step 1
            resetLevelState();
        } else if (slotId === 1 && selectedParticiple) {
            // Reset only step 2
            selectedEnding = null;
            slotEnd.textContent = "Ende?";
            slotEnd.className = "slot";
            showEndingOptions();
        }
    }
    
    // Alias for the button
    function resetLevel() {
        if (btnNext.style.display === 'inline-block') return;
        resetLevelState();
    }

    function checkAnswer() {
        if (!selectedParticiple || !selectedEnding) {
            alert("Bitte f√ºllen Sie beide L√ºcken aus!");
            return;
        }

        const data = levels[currentIdx];
        const isPartCorrect = (selectedParticiple === data.partCorrect);
        const isEndCorrect = (selectedEnding === data.endCorrect);

        if (isPartCorrect && isEndCorrect) {
            // Success
            score++;
            slotPart.className = 'slot correct';
            slotEnd.className = 'slot correct';
            feedback.innerHTML = "Perfekt! Der Satz ist korrekt.";
            feedback.className = "feedback fb-success";
        } else {
            // Error
            feedback.className = "feedback fb-error";
            let msg = "Nicht ganz.";
            
            if (!isPartCorrect) {
                slotPart.className = 'slot wrong';
                msg += `<br>Das Partizip ist falsch. ${data.explanation}`;
            } else {
                slotPart.className = 'slot correct';
            }

            if (!isEndCorrect) {
                slotEnd.className = 'slot wrong';
                msg += `<br>Das Ende ergibt keinen Sinn.`;
            } else {
                slotEnd.className = 'slot correct';
            }
            
            feedback.innerHTML = msg;
        }

        feedback.style.display = 'block';
        
        // Show Next
        if (currentIdx < levels.length - 1) {
            btnNext.textContent = "Weiter \u2192";
        } else {
            btnNext.textContent = "Ergebnis";
            progressBar.style.width = '100%';
        }
        btnNext.style.display = 'inline-block';
    }

    function nextLevel() {
        if (currentIdx < levels.length - 1) {
            loadLevel(currentIdx + 1);
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        ui.style.display = 'none';
        endScreen.style.display = 'block';
        finalScore.textContent = `${score}/${levels.length}`;
    }

    // Start
    initGame();

</script>

</body>
</html>